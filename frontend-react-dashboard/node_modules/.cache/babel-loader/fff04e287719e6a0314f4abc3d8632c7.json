{"ast":null,"code":"/**\r\n * DevExtreme (ui/themes.js)\r\n * Version: 20.1.7\r\n * Build date: Tue Aug 25 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _devices = require(\"../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _dom_adapter = require(\"../core/dom_adapter\");\n\nvar _dom_adapter2 = _interopRequireDefault(_dom_adapter);\n\nvar _promise = require(\"../core/polyfills/promise\");\n\nvar _promise2 = _interopRequireDefault(_promise);\n\nvar _renderer = require(\"../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nvar _html_parser = require(\"../core/utils/html_parser\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _ready_callbacks = require(\"../core/utils/ready_callbacks\");\n\nvar _ready_callbacks2 = _interopRequireDefault(_ready_callbacks);\n\nvar _view_port = require(\"../core/utils/view_port\");\n\nvar _window = require(\"../core/utils/window\");\n\nvar _themes_callback = require(\"./themes_callback\");\n\nvar _ui = require(\"./widget/ui.errors\");\n\nvar _ui2 = _interopRequireDefault(_ui);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar window = (0, _window.getWindow)();\nvar ready = _ready_callbacks2.default.add;\nvar viewPort = _view_port.value;\nvar viewPortChanged = _view_port.changeCallback;\nvar DX_LINK_SELECTOR = \"link[rel=dx-theme]\";\nvar THEME_ATTR = \"data-theme\";\nvar ACTIVE_ATTR = \"data-active\";\nvar DX_HAIRLINES_CLASS = \"dx-hairlines\";\nvar ANY_THEME = \"any\";\nvar context;\nvar $activeThemeLink;\nvar knownThemes;\nvar currentThemeName;\nvar pendingThemeName;\nvar defaultTimeout = 15e3;\nvar THEME_MARKER_PREFIX = \"dx.\";\nvar inited = false;\n\n_themes_callback.themeInitializedCallback.add(function () {\n  return inited = true;\n});\n\nfunction readThemeMarker() {\n  if (!(0, _window.hasWindow)()) {\n    return null;\n  }\n\n  var element = (0, _renderer2.default)(\"<div>\", context).addClass(\"dx-theme-marker\").appendTo(context.documentElement);\n  var result;\n\n  try {\n    result = element.css(\"fontFamily\");\n\n    if (!result) {\n      return null;\n    }\n\n    result = result.replace(/[\"']/g, \"\");\n\n    if (result.substr(0, THEME_MARKER_PREFIX.length) !== THEME_MARKER_PREFIX) {\n      return null;\n    }\n\n    return result.substr(THEME_MARKER_PREFIX.length);\n  } finally {\n    element.remove();\n  }\n}\n\nfunction waitForThemeLoad(themeName) {\n  var waitStartTime;\n  var timerId;\n  var intervalCleared = true;\n  pendingThemeName = themeName;\n\n  function handleLoaded() {\n    pendingThemeName = null;\n    clearInterval(timerId);\n    intervalCleared = true;\n\n    _themes_callback.themeReadyCallback.fire();\n\n    _themes_callback.themeReadyCallback.empty();\n\n    if (!inited) {\n      _themes_callback.themeInitializedCallback.fire();\n\n      _themes_callback.themeInitializedCallback.empty();\n    }\n  }\n\n  if (isPendingThemeLoaded() || !defaultTimeout) {\n    handleLoaded();\n  } else {\n    if (!intervalCleared) {\n      if (pendingThemeName) {\n        pendingThemeName = themeName;\n      }\n\n      return;\n    }\n\n    waitStartTime = Date.now();\n    intervalCleared = false;\n    timerId = setInterval(function () {\n      var isLoaded = isPendingThemeLoaded();\n      var isTimeout = !isLoaded && Date.now() - waitStartTime > defaultTimeout;\n\n      if (isTimeout) {\n        _ui2.default.log(\"W0004\", pendingThemeName);\n      }\n\n      if (isLoaded || isTimeout) {\n        handleLoaded();\n      }\n    }, 10);\n  }\n}\n\nfunction isPendingThemeLoaded() {\n  if (!pendingThemeName) {\n    return true;\n  }\n\n  var anyThemePending = pendingThemeName === ANY_THEME;\n\n  if (inited && anyThemePending) {\n    return true;\n  }\n\n  var themeMarker = readThemeMarker();\n\n  if (themeMarker && anyThemePending) {\n    return true;\n  }\n\n  return themeMarker === pendingThemeName;\n}\n\nfunction processMarkup() {\n  var $allThemeLinks = (0, _renderer2.default)(DX_LINK_SELECTOR, context);\n\n  if (!$allThemeLinks.length) {\n    return;\n  }\n\n  knownThemes = {};\n  $activeThemeLink = (0, _renderer2.default)((0, _html_parser.parseHTML)(\"<link rel=stylesheet>\"), context);\n  $allThemeLinks.each(function () {\n    var link = (0, _renderer2.default)(this, context);\n    var fullThemeName = link.attr(THEME_ATTR);\n    var url = link.attr(\"href\");\n    var isActive = \"true\" === link.attr(ACTIVE_ATTR);\n    knownThemes[fullThemeName] = {\n      url: url,\n      isActive: isActive\n    };\n  });\n  $allThemeLinks.last().after($activeThemeLink);\n  $allThemeLinks.remove();\n}\n\nfunction resolveFullThemeName(desiredThemeName) {\n  var desiredThemeParts = desiredThemeName ? desiredThemeName.split(\".\") : [];\n  var result = null;\n\n  if (knownThemes) {\n    if (desiredThemeName in knownThemes) {\n      return desiredThemeName;\n    }\n\n    (0, _iterator.each)(knownThemes, function (knownThemeName, themeData) {\n      var knownThemeParts = knownThemeName.split(\".\");\n\n      if (desiredThemeParts[0] && knownThemeParts[0] !== desiredThemeParts[0]) {\n        return;\n      }\n\n      if (desiredThemeParts[1] && desiredThemeParts[1] !== knownThemeParts[1]) {\n        return;\n      }\n\n      if (desiredThemeParts[2] && desiredThemeParts[2] !== knownThemeParts[2]) {\n        return;\n      }\n\n      if (!result || themeData.isActive) {\n        result = knownThemeName;\n      }\n\n      if (themeData.isActive) {\n        return false;\n      }\n    });\n  }\n\n  return result;\n}\n\nfunction initContext(newContext) {\n  try {\n    if (newContext !== context) {\n      knownThemes = null;\n    }\n  } catch (x) {\n    knownThemes = null;\n  }\n\n  context = newContext;\n}\n\nfunction init(options) {\n  options = options || {};\n  initContext(options.context || _dom_adapter2.default.getDocument());\n\n  if (!context) {\n    return;\n  }\n\n  processMarkup();\n  currentThemeName = void 0;\n  current(options);\n}\n\nfunction current(options) {\n  if (!arguments.length) {\n    currentThemeName = currentThemeName || readThemeMarker();\n    return currentThemeName;\n  }\n\n  detachCssClasses(viewPort());\n  options = options || {};\n\n  if (\"string\" === typeof options) {\n    options = {\n      theme: options\n    };\n  }\n\n  var isAutoInit = options._autoInit;\n  var loadCallback = options.loadCallback;\n  var currentThemeData;\n  currentThemeName = resolveFullThemeName(options.theme || currentThemeName);\n\n  if (currentThemeName) {\n    currentThemeData = knownThemes[currentThemeName];\n  }\n\n  if (loadCallback) {\n    _themes_callback.themeReadyCallback.add(loadCallback);\n  }\n\n  if (currentThemeData) {\n    $activeThemeLink.attr(\"href\", knownThemes[currentThemeName].url);\n\n    if (_themes_callback.themeReadyCallback.has() || options._forceTimeout) {\n      waitForThemeLoad(currentThemeName);\n    }\n  } else {\n    if (isAutoInit) {\n      waitForThemeLoad(ANY_THEME);\n\n      _themes_callback.themeReadyCallback.fire();\n\n      _themes_callback.themeReadyCallback.empty();\n    } else {\n      throw _ui2.default.Error(\"E0021\", currentThemeName);\n    }\n  }\n\n  checkThemeDeprecation();\n  attachCssClasses((0, _view_port.originalViewPort)(), currentThemeName);\n}\n\nfunction getCssClasses(themeName) {\n  themeName = themeName || current();\n  var result = [];\n  var themeNameParts = themeName && themeName.split(\".\");\n\n  if (themeNameParts) {\n    result.push(\"dx-theme-\" + themeNameParts[0], \"dx-theme-\" + themeNameParts[0] + \"-typography\");\n\n    if (themeNameParts.length > 1) {\n      result.push(\"dx-color-scheme-\" + themeNameParts[1] + (isMaterial(themeName) ? \"-\" + themeNameParts[2] : \"\"));\n    }\n  }\n\n  return result;\n}\n\nvar themeClasses;\n\nfunction attachCssClasses(element, themeName) {\n  themeClasses = getCssClasses(themeName).join(\" \");\n  (0, _renderer2.default)(element).addClass(themeClasses);\n\n  var activateHairlines = function activateHairlines() {\n    var pixelRatio = (0, _window.hasWindow)() && window.devicePixelRatio;\n\n    if (!pixelRatio || pixelRatio < 2) {\n      return;\n    }\n\n    var $tester = (0, _renderer2.default)(\"<div>\");\n    $tester.css(\"border\", \".5px solid transparent\");\n    (0, _renderer2.default)(\"body\").append($tester);\n\n    if (1 === $tester.outerHeight()) {\n      (0, _renderer2.default)(element).addClass(DX_HAIRLINES_CLASS);\n      themeClasses += \" \" + DX_HAIRLINES_CLASS;\n    }\n\n    $tester.remove();\n  };\n\n  activateHairlines();\n}\n\nfunction detachCssClasses(element) {\n  (0, _renderer2.default)(element).removeClass(themeClasses);\n}\n\nfunction themeReady(callback) {\n  _themes_callback.themeReadyCallback.add(callback);\n}\n\nfunction isTheme(themeRegExp, themeName) {\n  if (!themeName) {\n    themeName = currentThemeName || readThemeMarker();\n  }\n\n  return new RegExp(themeRegExp).test(themeName);\n}\n\nfunction isMaterial(themeName) {\n  return isTheme(\"material\", themeName);\n}\n\nfunction isIos7(themeName) {\n  return isTheme(\"ios7\", themeName);\n}\n\nfunction isGeneric(themeName) {\n  return isTheme(\"generic\", themeName);\n}\n\nfunction isDark(themeName) {\n  return isTheme(\"dark\", themeName);\n}\n\nfunction checkThemeDeprecation() {\n  if (isIos7()) {\n    _ui2.default.log(\"W0010\", \"The 'ios7' theme\", \"19.1\", \"Use the 'generic' theme instead.\");\n  }\n}\n\nfunction isWebFontLoaded(text, fontWeight) {\n  var testedFont = \"Roboto, RobotoFallback, Arial\";\n  var etalonFont = \"Arial\";\n\n  var document = _dom_adapter2.default.getDocument();\n\n  var testElement = document.createElement(\"span\");\n  testElement.style.position = \"absolute\";\n  testElement.style.top = \"-9999px\";\n  testElement.style.left = \"-9999px\";\n  testElement.style.visibility = \"hidden\";\n  testElement.style.fontFamily = etalonFont;\n  testElement.style.fontSize = \"250px\";\n  testElement.style.fontWeight = fontWeight;\n  testElement.innerHTML = text;\n  document.body.appendChild(testElement);\n  var etalonFontWidth = testElement.offsetWidth;\n  testElement.style.fontFamily = testedFont;\n  var testedFontWidth = testElement.offsetWidth;\n  testElement.parentNode.removeChild(testElement);\n  return etalonFontWidth !== testedFontWidth;\n}\n\nfunction waitWebFont(text, fontWeight) {\n  var interval = 15;\n  var timeout = 2e3;\n  return new _promise2.default(function (resolve) {\n    var check = function check() {\n      if (isWebFontLoaded(text, fontWeight)) {\n        clear();\n      }\n    };\n\n    var clear = function clear() {\n      clearInterval(intervalId);\n      clearTimeout(timeoutId);\n      resolve();\n    };\n\n    var intervalId = setInterval(check, interval);\n    var timeoutId = setTimeout(clear, timeout);\n  });\n}\n\nvar initDeferred = new _deferred.Deferred();\n\nfunction autoInit() {\n  init({\n    _autoInit: true,\n    _forceTimeout: true\n  });\n\n  if ((0, _renderer2.default)(DX_LINK_SELECTOR, context).length) {\n    throw _ui2.default.Error(\"E0022\");\n  }\n\n  initDeferred.resolve();\n}\n\nif ((0, _window.hasWindow)()) {\n  autoInit();\n} else {\n  ready(autoInit);\n}\n\nviewPortChanged.add(function (viewPort, prevViewPort) {\n  initDeferred.done(function () {\n    detachCssClasses(prevViewPort);\n    attachCssClasses(viewPort);\n  });\n});\n\n_devices2.default.changed.add(function () {\n  init({\n    _autoInit: true\n  });\n});\n\nexports.init = init;\nexports.waitForThemeLoad = waitForThemeLoad;\nexports.current = current;\nexports.attachCssClasses = attachCssClasses;\nexports.detachCssClasses = detachCssClasses;\nexports.isMaterial = isMaterial;\nexports.isIos7 = isIos7;\nexports.isGeneric = isGeneric;\nexports.isDark = isDark;\nexports.checkThemeDeprecation = checkThemeDeprecation;\nexports.isWebFontLoaded = isWebFontLoaded;\nexports.waitWebFont = waitWebFont;\nexports.ready = themeReady;\nexports.resetTheme = function () {\n  $activeThemeLink && $activeThemeLink.attr(\"href\", \"about:blank\");\n  currentThemeName = null;\n  pendingThemeName = null;\n  inited = false;\n\n  _themes_callback.themeInitializedCallback.add(function () {\n    return inited = true;\n  });\n}, exports.setDefaultTimeout = function (timeout) {\n  defaultTimeout = timeout;\n};\n\nexports.initialized = function (callback) {\n  if (inited) {\n    callback();\n  } else {\n    _themes_callback.themeInitializedCallback.add(callback);\n  }\n};\n\nmodule.exports.default = module.exports;","map":null,"metadata":{},"sourceType":"script"}