{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointment_form.js)\r\n * Version: 20.1.7\r\n * Build date: Tue Aug 25 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar _form = require(\"../form\");\n\nvar _form2 = _interopRequireDefault(_form);\n\nvar _date_serialization = require(\"../../core/utils/date_serialization\");\n\nvar _date_serialization2 = _interopRequireDefault(_date_serialization);\n\nvar _message = require(\"../../localization/message\");\n\nvar _message2 = _interopRequireDefault(_message);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nrequire(\"./ui.scheduler.recurrence_editor\");\n\nrequire(\"./timezones/ui.scheduler.timezone_editor\");\n\nrequire(\"../text_area\");\n\nrequire(\"../tag_box\");\n\nrequire(\"../switch\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar SCREEN_SIZE_OF_SINGLE_COLUMN = 600;\nvar APPOINTMENT_FORM_GROUP_NAMES = {\n  Main: \"mainGroup\",\n  Recurrence: \"recurrenceGroup\"\n};\nvar SchedulerAppointmentForm = {\n  _appointmentForm: {},\n  _lockDateShiftFlag: false,\n  _validateAppointmentFormDate: function _validateAppointmentFormDate(editor, value, previousValue) {\n    var isCurrentDateCorrect = null === value || !!value;\n    var isPreviousDateCorrect = null === previousValue || !!previousValue;\n\n    if (!isCurrentDateCorrect && isPreviousDateCorrect) {\n      editor.option(\"value\", previousValue);\n    }\n  },\n  _getAllDayStartDate: function _getAllDayStartDate(startDate) {\n    return new Date(new Date(startDate).setHours(0, 0, 0, 0));\n  },\n  _getAllDayEndDate: function _getAllDayEndDate(startDate) {\n    return new Date(new Date(startDate).setDate(startDate.getDate() + 1));\n  },\n  _getStartDateWithStartHour: function _getStartDateWithStartHour(startDate, startDayHour) {\n    return new Date(new Date(startDate).setHours(startDayHour));\n  },\n  create: function create(componentCreator, $container, isReadOnly, formData) {\n    this._appointmentForm = componentCreator($container, _form2.default, {\n      items: this._editors,\n      readOnly: isReadOnly,\n      showValidationSummary: true,\n      scrollingEnabled: true,\n      colCount: \"auto\",\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      formData: formData,\n      showColonAfterLabel: false,\n      labelLocation: \"top\",\n      screenByWidth: function screenByWidth(width) {\n        return width < SCREEN_SIZE_OF_SINGLE_COLUMN || \"desktop\" !== _devices2.default.current().deviceType ? \"xs\" : \"lg\";\n      }\n    });\n    return this._appointmentForm;\n  },\n  _dateBoxValueChanged: function _dateBoxValueChanged(args, dateExpr, isNeedCorrect) {\n    this._validateAppointmentFormDate(args.component, args.value, args.previousValue);\n\n    var value = _date_serialization2.default.deserializeDate(args.value);\n\n    var previousValue = _date_serialization2.default.deserializeDate(args.previousValue);\n\n    var dateEditor = this._appointmentForm.getEditor(dateExpr);\n\n    var dateValue = _date_serialization2.default.deserializeDate(dateEditor.option(\"value\"));\n\n    if (!this._appointmentForm._lockDateShiftFlag && dateValue && value && isNeedCorrect(dateValue, value)) {\n      var duration = previousValue ? dateValue.getTime() - previousValue.getTime() : 0;\n      dateEditor.option(\"value\", new Date(value.getTime() + duration));\n    }\n  },\n  _getTimezoneEditor: function _getTimezoneEditor(timeZoneExpr, secondTimeZoneExpr, visibleIndex, colSpan, schedulerInst, isMainTimeZone) {\n    var _this = this;\n\n    var isShow = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : false;\n    return {\n      dataField: timeZoneExpr,\n      editorType: \"dxSchedulerTimezoneEditor\",\n      visibleIndex: visibleIndex,\n      colSpan: colSpan,\n      label: {\n        text: \" \"\n      },\n      editorOptions: {\n        observer: schedulerInst,\n        onValueChanged: function onValueChanged(args) {\n          var form = _this._appointmentForm;\n          var secondTimezoneEditor = form.getEditor(secondTimeZoneExpr);\n\n          if (isMainTimeZone) {\n            secondTimezoneEditor.option(\"value\", args.value);\n          }\n        }\n      },\n      visible: isShow\n    };\n  },\n  _getDateBoxEditor: function _getDateBoxEditor(dataExpr, colSpan, firstDayOfWeek, label, callback) {\n    return {\n      dataField: dataExpr,\n      editorType: \"dxDateBox\",\n      colSpan: colSpan,\n      label: {\n        text: _message2.default.format(label)\n      },\n      validationRules: [{\n        type: \"required\"\n      }],\n      editorOptions: {\n        width: \"100%\",\n        calendarOptions: {\n          firstDayOfWeek: firstDayOfWeek\n        },\n        onValueChanged: callback\n      }\n    };\n  },\n  _getDateBoxItems: function _getDateBoxItems(dataExprs, schedulerInst, allowTimeZoneEditing) {\n    var _this2 = this;\n\n    var colSpan = allowTimeZoneEditing ? 2 : 1;\n    var firstDayOfWeek = schedulerInst.option(\"firstDayOfWeek\");\n    return [this._getDateBoxEditor(dataExprs.startDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelStartDate\", function (args) {\n      _this2._dateBoxValueChanged(args, dataExprs.endDateExpr, function (endValue, startValue) {\n        return endValue < startValue;\n      });\n    }), this._getTimezoneEditor(dataExprs.startDateTimeZoneExpr, dataExprs.endDateTimeZoneExpr, 1, colSpan, schedulerInst, true, allowTimeZoneEditing), this._getDateBoxEditor(dataExprs.endDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelEndDate\", function (args) {\n      _this2._dateBoxValueChanged(args, dataExprs.startDateExpr, function (startValue, endValue) {\n        return endValue < startValue;\n      });\n    }), this._getTimezoneEditor(dataExprs.endDateTimeZoneExpr, dataExprs.startDateTimeZoneExpr, 3, colSpan, schedulerInst, false, allowTimeZoneEditing)];\n  },\n  _getMainItems: function _getMainItems(dataExprs, schedulerInst, triggerResize, changeSize, allowTimeZoneEditing) {\n    var _this3 = this;\n\n    return [{\n      dataField: dataExprs.textExpr,\n      editorType: \"dxTextBox\",\n      colSpan: 2,\n      label: {\n        text: _message2.default.format(\"dxScheduler-editorLabelTitle\")\n      }\n    }, {\n      itemType: \"group\",\n      colSpan: 2,\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      items: this._getDateBoxItems(dataExprs, schedulerInst, allowTimeZoneEditing)\n    }, {\n      itemType: \"group\",\n      colCountByScreen: {\n        lg: 3,\n        xs: 3\n      },\n      colSpan: 2,\n      items: [{\n        dataField: dataExprs.allDayExpr,\n        cssClass: \"dx-appointment-form-switch\",\n        editorType: \"dxSwitch\",\n        label: {\n          text: _message2.default.format(\"dxScheduler-allDay\"),\n          location: \"right\"\n        },\n        editorOptions: {\n          onValueChanged: function onValueChanged(args) {\n            var value = args.value;\n\n            var startDateEditor = _this3._appointmentForm.getEditor(dataExprs.startDateExpr);\n\n            var endDateEditor = _this3._appointmentForm.getEditor(dataExprs.endDateExpr);\n\n            var startDate = _date_serialization2.default.deserializeDate(startDateEditor.option(\"value\"));\n\n            if (!_this3._appointmentForm._lockDateShiftFlag && startDate) {\n              if (value) {\n                var allDayStartDate = _this3._getAllDayStartDate(startDate);\n\n                startDateEditor.option(\"value\", allDayStartDate);\n                endDateEditor.option(\"value\", _this3._getAllDayEndDate(allDayStartDate));\n              } else {\n                var startDateWithStartHour = _this3._getStartDateWithStartHour(startDate, schedulerInst.option(\"startDayHour\"));\n\n                var endDate = schedulerInst._workSpace.calculateEndDate(startDateWithStartHour);\n\n                startDateEditor.option(\"value\", startDateWithStartHour);\n                endDateEditor.option(\"value\", endDate);\n              }\n            }\n\n            startDateEditor.option(\"type\", value ? \"date\" : \"datetime\");\n            endDateEditor.option(\"type\", value ? \"date\" : \"datetime\");\n          }\n        }\n      }, {\n        editorType: \"dxSwitch\",\n        dataField: \"repeat\",\n        cssClass: \"dx-appointment-form-switch\",\n        name: \"visibilityChanged\",\n        label: {\n          text: _message2.default.format(\"dxScheduler-editorLabelRecurrence\"),\n          location: \"right\"\n        },\n        editorOptions: {\n          onValueChanged: function onValueChanged(args) {\n            var form = _this3._appointmentForm;\n            var colSpan = args.value ? 1 : 2;\n            form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Main, \"colSpan\", colSpan);\n            form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"colSpan\", colSpan);\n\n            _this3._updateRecurrenceItemVisibility(dataExprs.recurrenceRuleExpr, args.value, form);\n\n            changeSize(args.value);\n            triggerResize();\n          }\n        }\n      }]\n    }, {\n      itemType: \"empty\",\n      colSpan: 2\n    }, {\n      dataField: dataExprs.descriptionExpr,\n      editorType: \"dxTextArea\",\n      colSpan: 2,\n      label: {\n        text: _message2.default.format(\"dxScheduler-editorLabelDescription\")\n      }\n    }, {\n      itemType: \"empty\",\n      colSpan: 2\n    }];\n  },\n  _updateRecurrenceItemVisibility: function _updateRecurrenceItemVisibility(recurrenceRuleExpr, value, form) {\n    var _form$getEditor;\n\n    form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"visible\", value);\n    !value && form.updateData(recurrenceRuleExpr, \"\");\n    null === (_form$getEditor = form.getEditor(recurrenceRuleExpr)) || void 0 === _form$getEditor ? void 0 : _form$getEditor.changeValueByVisibility(value);\n  },\n  prepareAppointmentFormEditors: function prepareAppointmentFormEditors(dataExprs, schedulerInst, triggerResize, changeSize, appointmentData, allowTimeZoneEditing, readOnly) {\n    var recurrenceEditorVisibility = !!this.getRecurrenceRule(appointmentData, dataExprs);\n    changeSize(recurrenceEditorVisibility);\n    this._editors = [{\n      itemType: \"group\",\n      name: APPOINTMENT_FORM_GROUP_NAMES.Main,\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      colSpan: recurrenceEditorVisibility ? 1 : 2,\n      items: this._getMainItems(dataExprs, schedulerInst, triggerResize, changeSize, allowTimeZoneEditing)\n    }, {\n      itemType: \"group\",\n      name: APPOINTMENT_FORM_GROUP_NAMES.Recurrence,\n      visible: recurrenceEditorVisibility,\n      colSpan: recurrenceEditorVisibility ? 1 : 2,\n      items: this._createRecurrenceEditor(dataExprs, schedulerInst, recurrenceEditorVisibility, readOnly)\n    }];\n    return this._editors;\n  },\n  _createRecurrenceEditor: function _createRecurrenceEditor(dataExprs, schedulerInst, recurrenceEditorVisibility, readOnly) {\n    return [{\n      dataField: dataExprs.recurrenceRuleExpr,\n      editorType: \"dxRecurrenceEditor\",\n      editorOptions: {\n        readOnly: readOnly,\n        firstDayOfWeek: schedulerInst.option(\"firstDayOfWeek\")\n      },\n      label: {\n        text: \" \",\n        visible: false\n      }\n    }];\n  },\n  getRecurrenceRule: function getRecurrenceRule(data, dataExprs) {\n    return data[dataExprs.recurrenceRuleExpr];\n  },\n  concatResources: function concatResources(resources) {\n    this._editors[0].items = this._editors[0].items.concat(resources);\n  },\n  setEditorsType: function setEditorsType(form, startDateExpr, endDateExpr, allDay) {\n    var startDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(startDateExpr);\n    var endDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \".\").concat(endDateExpr);\n    var startDateFormItem = form.itemOption(startDateItemPath);\n    var endDateFormItem = form.itemOption(endDateItemPath);\n\n    if (startDateFormItem && endDateFormItem) {\n      var startDateEditorOptions = startDateFormItem.editorOptions;\n      var endDateEditorOptions = endDateFormItem.editorOptions;\n      startDateEditorOptions.type = endDateEditorOptions.type = allDay ? \"date\" : \"datetime\";\n      form.itemOption(startDateItemPath, \"editorOptions\", startDateEditorOptions);\n      form.itemOption(endDateItemPath, \"editorOptions\", endDateEditorOptions);\n    }\n  },\n  updateFormData: function updateFormData(appointmentForm, formData) {\n    appointmentForm._lockDateShiftFlag = true;\n    appointmentForm.option(\"formData\", formData);\n    appointmentForm._lockDateShiftFlag = false;\n  }\n};\nmodule.exports = {\n  AppointmentForm: SchedulerAppointmentForm,\n  APPOINTMENT_FORM_GROUP_NAMES: APPOINTMENT_FORM_GROUP_NAMES\n};","map":null,"metadata":{},"sourceType":"script"}